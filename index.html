<!DOCTYPE html>
<html lang="ms">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Kewangan LDP 2026</title>
    <!-- Tailwind CSS for Styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Chart.js for Visualizations -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700;800&display=swap');
        body { font-family: 'Plus Jakarta Sans', sans-serif; }
        .chart-container { position: relative; height: 300px; width: 100%; }
    </style>
</head>
<body class="bg-slate-50 text-slate-800 min-h-screen pb-12">

    <!-- Header Section -->
    <header class="bg-white border-b border-slate-200 px-6 py-8 mb-8 shadow-sm">
        <div class="max-w-7xl mx-auto flex flex-col md:flex-row md:items-center justify-between gap-4">
            <div>
                <h1 class="text-3xl font-extrabold text-slate-900 tracking-tight">Dashboard Kewangan LDP</h1>
                <p class="text-slate-500 font-medium">Laporan Prestasi BPG IAB Tahun 2026</p>
            </div>
            <div class="flex items-center gap-2 bg-emerald-50 text-emerald-700 px-4 py-2 rounded-full text-sm font-bold border border-emerald-100">
                <span class="w-2 h-2 bg-emerald-500 rounded-full animate-pulse"></span>
                Sistem Kemas Kini Automatik
            </div>
        </div>
    </header>

    <main class="max-w-7xl mx-auto px-6">
        
        <!-- Tab Navigation -->
        <nav class="flex flex-wrap gap-2 mb-6 bg-slate-200/50 p-1.5 rounded-2xl w-fit">
            <button onclick="switchTab('analisis')" id="btn-analisis" class="tab-btn px-6 py-2.5 rounded-xl text-sm font-bold transition-all bg-white text-blue-600 shadow-sm">Analisis Keseluruhan</button>
            <button onclick="switchTab('coe')" id="btn-coe" class="tab-btn px-6 py-2.5 rounded-xl text-sm font-bold transition-all text-slate-500 hover:text-slate-700">Pemerkasaan COE</button>
            <button onclick="switchTab('assessor')" id="btn-assessor" class="tab-btn px-6 py-2.5 rounded-xl text-sm font-bold transition-all text-slate-500 hover:text-slate-700">Certified Assessor</button>
            <button onclick="switchTab('lead')" id="btn-lead" class="tab-btn px-6 py-2.5 rounded-xl text-sm font-bold transition-all text-slate-500 hover:text-slate-700">Lead Auditor</button>
        </nav>

        <!-- Warrant Information Section (Visible in Analysis Tab) -->
        <div id="warrant-section" class="mb-8 hidden">
            <div class="bg-blue-600 rounded-3xl p-8 text-white shadow-lg shadow-blue-200 relative overflow-hidden">
                <div class="relative z-10 flex flex-col md:flex-row justify-between items-start md:items-center gap-6">
                    <div>
                        <span class="bg-blue-500 text-blue-100 text-[10px] font-extrabold uppercase tracking-widest px-3 py-1 rounded-full border border-blue-400">Maklumat Waran Peruntukan</span>
                        <h2 class="text-2xl font-bold mt-3" id="warrant-no">-</h2>
                        <p class="text-blue-100 text-sm mt-1" id="warrant-details">No. Dokumen: - | Tarikh: -</p>
                    </div>
                    <div class="flex gap-4">
                        <div class="bg-white/10 backdrop-blur-md p-4 rounded-2xl border border-white/20">
                            <p class="text-[10px] font-bold uppercase text-blue-100 opacity-80">Waran OS21</p>
                            <p class="text-lg font-bold" id="warrant-os21">RM 0.00</p>
                        </div>
                        <div class="bg-white/10 backdrop-blur-md p-4 rounded-2xl border border-white/20">
                            <p class="text-[10px] font-bold uppercase text-blue-100 opacity-80">Waran OS29</p>
                            <p class="text-lg font-bold" id="warrant-os29">RM 0.00</p>
                        </div>
                    </div>
                </div>
                <!-- Abstract background shapes -->
                <div class="absolute -right-10 -bottom-10 w-40 h-40 bg-white/10 rounded-full blur-3xl"></div>
                <div class="absolute -left-10 -top-10 w-40 h-40 bg-blue-400/20 rounded-full blur-3xl"></div>
            </div>
        </div>

        <!-- KPI Cards -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-10" id="kpi-container">
            <!-- Will be populated by JS -->
        </div>

        <!-- Charts Section -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 mb-10">
            <!-- Bar Chart -->
            <div class="lg:col-span-2 bg-white p-8 rounded-3xl shadow-sm border border-slate-200">
                <h3 class="text-lg font-bold text-slate-800 mb-6 uppercase tracking-wider text-xs">Perbandingan Peruntukan vs Perbelanjaan</h3>
                <div class="chart-container">
                    <canvas id="barChart"></canvas>
                </div>
            </div>
            <!-- Pie Chart -->
            <div class="bg-white p-8 rounded-3xl shadow-sm border border-slate-200">
                <h3 class="text-lg font-bold text-slate-800 mb-6 uppercase tracking-wider text-xs">Pecahan Kod Objek (OS)</h3>
                <div class="chart-container" style="height: 250px;">
                    <canvas id="pieChart"></canvas>
                </div>
                <div id="pie-legend" class="mt-6 space-y-2"></div>
            </div>
        </div>

        <!-- Data Table -->
        <div class="bg-white rounded-3xl shadow-sm border border-slate-200 overflow-hidden">
            <div class="p-8 border-b border-slate-100 flex justify-between items-center">
                <h3 class="text-xl font-bold text-slate-900" id="table-title">Butiran Program</h3>
                <span class="text-xs font-bold text-slate-400 uppercase tracking-widest">Unit: Ringgit Malaysia (RM)</span>
            </div>
            <div class="overflow-x-auto">
                <table class="w-full text-left">
                    <thead>
                        <tr class="bg-slate-50/50 text-slate-500 font-bold text-xs uppercase tracking-widest border-b border-slate-100">
                            <th class="px-8 py-5">Nama Aktiviti / Program</th>
                            <th class="px-8 py-5 text-right">Peruntukan</th>
                            <th class="px-8 py-5 text-right">Perbelanjaan</th>
                            <th class="px-8 py-5 text-right">Baki</th>
                            <th class="px-8 py-5 text-center">Status</th>
                        </tr>
                    </thead>
                    <tbody id="table-body" class="divide-y divide-slate-100">
                        <!-- Will be populated by JS -->
                    </tbody>
                </table>
            </div>
        </div>
    </main>

    <script>
        // Data berdasarkan fail CSV Analisis dan Helaian Program
        const data = {
            analisis: {
                title: "Analisis Keseluruhan",
                warrant: {
                    no: "WARAN PERUNTUKAN LDP-BPG-050202",
                    doc: "91000001",
                    date: "12 Jan 2026",
                    os21: 35391,
                    os29: 15972,
                    total: 51363
                },
                items: [
                    { name: "LDP-BPG-PEMERKASAAN COE", alloc: 42600, spent: 0, os21: 30000, os29: 12600 },
                    { name: "LDP-BPG-CERTIFIED ASSESSOR", alloc: 9400, spent: 9400, os21: 7000, os29: 2400 },
                    { name: "LDP-BPG-LEAD AUDITOR", alloc: 0, spent: 0, os21: 0, os29: 0 }
                ]
            },
            coe: {
                title: "LDP-BPG-PEMERKASAAN COE",
                items: [
                    { name: "Bengkel Penyelarasan COE Bil. 1-5/2026", alloc: 42600, spent: 0, os21: 30000, os29: 12600 }
                ]
            },
            assessor: {
                title: "LDP-BPG-CERTIFIED ASSESSOR",
                items: [
                    { name: "Bengkel Kerja Penyelarasan Pensijilan Certified Assessor", alloc: 9400, spent: 9400, os21: 7000, os29: 2400 }
                ]
            },
            lead: {
                title: "LDP-BPG-LEAD AUDITOR",
                items: [
                    { name: "Kursus Ketua Juruaudit ISO 9001:2015", alloc: 0, spent: 0, os21: 0, os29: 0 }
                ]
            }
        };

        let barChart, pieChart;

        function formatRM(val) {
            return new Intl.NumberFormat('en-MY', { style: 'currency', currency: 'MYR' }).format(val);
        }

        function updateUI(tabKey) {
            const current = data[tabKey];
            const items = current.items;
            
            // Show/Hide Warrant Section
            const warrantSec = document.getElementById('warrant-section');
            if (current.warrant) {
                warrantSec.classList.remove('hidden');
                document.getElementById('warrant-no').innerText = current.warrant.no;
                document.getElementById('warrant-details').innerText = `No. Dokumen: ${current.warrant.doc} | Tarikh: ${current.warrant.date}`;
                document.getElementById('warrant-os21').innerText = formatRM(current.warrant.os21);
                document.getElementById('warrant-os29').innerText = formatRM(current.warrant.os29);
            } else {
                warrantSec.classList.add('hidden');
            }

            // Calculate Totals for KPIs
            const totalAlloc = items.reduce((a, b) => a + b.alloc, 0);
            const totalSpent = items.reduce((a, b) => a + b.spent, 0);
            const totalOS21 = items.reduce((a, b) => a + b.os21, 0);
            const totalOS29 = items.reduce((a, b) => a + b.os29, 0);
            const balance = totalAlloc - totalSpent;
            const percentage = totalAlloc > 0 ? (totalSpent / totalAlloc * 100).toFixed(1) : 0;

            // Update KPI Cards
            const kpiContainer = document.getElementById('kpi-container');
            kpiContainer.innerHTML = `
                <div class="bg-white p-6 rounded-2xl border border-slate-200 shadow-sm">
                    <p class="text-slate-500 text-xs font-bold uppercase mb-1">Peruntukan Program</p>
                    <h3 class="text-2xl font-bold text-blue-600">${formatRM(totalAlloc)}</h3>
                </div>
                <div class="bg-white p-6 rounded-2xl border border-slate-200 shadow-sm">
                    <p class="text-slate-500 text-xs font-bold uppercase mb-1">Perbelanjaan Semasa</p>
                    <h3 class="text-2xl font-bold text-rose-500">${formatRM(totalSpent)}</h3>
                </div>
                <div class="bg-white p-6 rounded-2xl border border-slate-200 shadow-sm">
                    <p class="text-slate-500 text-xs font-bold uppercase mb-1">Baki Tersedia</p>
                    <h3 class="text-2xl font-bold text-emerald-600">${formatRM(balance)}</h3>
                </div>
                <div class="bg-white p-6 rounded-2xl border border-slate-200 shadow-sm">
                    <p class="text-slate-500 text-xs font-bold uppercase mb-1">Kadar Penggunaan</p>
                    <h3 class="text-2xl font-bold text-slate-800">${percentage}%</h3>
                </div>
            `;

            // Update Table
            document.getElementById('table-title').innerText = current.title;
            const tableBody = document.getElementById('table-body');
            tableBody.innerHTML = items.map(item => `
                <tr class="hover:bg-slate-50 transition-all">
                    <td class="px-8 py-5 font-bold text-slate-800">${item.name}</td>
                    <td class="px-8 py-5 text-right font-medium text-slate-600">${formatRM(item.alloc)}</td>
                    <td class="px-8 py-5 text-right font-medium text-rose-500">${formatRM(item.spent)}</td>
                    <td class="px-8 py-5 text-right font-bold text-emerald-600">${formatRM(item.alloc - item.spent)}</td>
                    <td class="px-8 py-5 text-center">
                        <span class="px-3 py-1 rounded-full text-[10px] font-bold uppercase ${item.spent > 0 ? (item.alloc - item.spent === 0 ? 'bg-emerald-100 text-emerald-700' : 'bg-blue-100 text-blue-700') : 'bg-slate-100 text-slate-500'}">
                            ${item.spent > 0 ? (item.alloc - item.spent === 0 ? 'Selesai' : 'Aktif') : 'Belum Mula'}
                        </span>
                    </td>
                </tr>
            `).join('');

            // Update Charts
            updateCharts(items, totalOS21, totalOS29);
        }

        function updateCharts(items, os21, os29) {
            const labels = items.map(i => i.name.length > 20 ? i.name.substring(0, 17) + "..." : i.name);
            const allocs = items.map(i => i.alloc);
            const spents = items.map(i => i.spent);

            if (barChart) barChart.destroy();
            if (pieChart) pieChart.destroy();

            const ctxBar = document.getElementById('barChart').getContext('2d');
            barChart = new Chart(ctxBar, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [
                        { label: 'Peruntukan', data: allocs, backgroundColor: '#3b82f6', borderRadius: 6 },
                        { label: 'Belanja', data: spents, backgroundColor: '#f43f5e', borderRadius: 6 }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: { 
                        y: { border: { display: false }, grid: { color: '#f1f5f9' }, ticks: { font: { size: 10 } } },
                        x: { border: { display: false }, grid: { display: false }, ticks: { font: { size: 10 } } }
                    }
                }
            });

            const ctxPie = document.getElementById('pieChart').getContext('2d');
            pieChart = new Chart(ctxPie, {
                type: 'doughnut',
                data: {
                    labels: ['OS21000', 'OS29000'],
                    datasets: [{
                        data: [os21, os29],
                        backgroundColor: ['#3b82f6', '#8b5cf6'],
                        borderWidth: 0,
                        hoverOffset: 10
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    cutout: '70%',
                    plugins: { legend: { display: false } }
                }
            });

            // Pie Legend
            const legendDiv = document.getElementById('pie-legend');
            legendDiv.innerHTML = `
                <div class="flex justify-between items-center text-sm p-3 bg-slate-50 rounded-xl">
                    <div class="flex items-center gap-2"><div class="w-3 h-3 rounded-full bg-blue-500"></div><b>OS21 (Perjalanan)</b></div>
                    <span>${formatRM(os21)}</span>
                </div>
                <div class="flex justify-between items-center text-sm p-3 bg-slate-50 rounded-xl">
                    <div class="flex items-center gap-2"><div class="w-3 h-3 rounded-full bg-purple-500"></div><b>OS29 (Iktisas)</b></div>
                    <span>${formatRM(os29)}</span>
                </div>
            `;
        }

        function switchTab(key) {
            // Update Buttons Style
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('bg-white', 'text-blue-600', 'shadow-sm');
                btn.classList.add('text-slate-500');
            });
            const activeBtn = document.getElementById(`btn-${key}`);
            activeBtn.classList.add('bg-white', 'text-blue-600', 'shadow-sm');
            activeBtn.classList.remove('text-slate-500');

            updateUI(key);
        }

        // Initialize
        window.onload = () => updateUI('analisis');
    </script>
</body>
</html>
